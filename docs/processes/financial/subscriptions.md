# Система абонементов

## Общее описание
Система абонементов Atlantis управляет доступом студентов к тренировкам. Абонементы имеют фиксированный срок действия (1 месяц) и определенное количество тренировок.

## Типы абонементов

### По количеству тренировок в месяц
- 4 тренировки (1 раз в неделю)
- 8 тренировок (2 раза в неделю)

### Параметры абонемента
- Срок действия: 1 календарный месяц
- Фиксированное количество тренировок
- Флаг автопродления
- Возможность переноса пропущенных тренировок

## Автопродление абонементов

### Механизм автопродления
- Флаг автопродления может быть включен или выключен только администратором
- При включенном автопродлении:
  * За 3 дня до окончания срока создается новый инвойс
  * Новый абонемент автоматически создается и начинается сразу после окончания текущего
  * Возможен перенос до 3-х пропущенных тренировок на следующий месяц
  * Доступ к тренировкам не зависит от статуса оплаты инвойса
- При выключенном автопродлении:
  * Новые инвойсы не создаются автоматически
  * Для продления требуется ручное создание абонемента
  * Перенос пропущенных тренировок недоступен

### Перенос пропущенных тренировок
- При активном автопродлении можно перенести до 3 пропущенных тренировок
- Перенесенные тренировки доступны только в следующем месяце
- Перенос возможен только при покупке нового абонемента
- Неиспользованные перенесенные тренировки сгорают в конце месяца

## Продление срока действия

### Автоматическое продление
- При отмене тренировки по вине школы
- Система автоматически пересчитывает дату окончания
- Добавляется количество дней равное количеству отмененных тренировок

### Правила продления
- Продление только для отмененных школой тренировок
- Пропуск по инициативе клиента не является основанием для продления
- История продлений сохраняется в системе

## Учет тренировок

### Списание тренировок
1. Сначала используются основные тренировки текущего месяца
2. Затем используются перенесенные тренировки (если есть)
3. При исчерпании лимита запись на тренировки становится недоступной до покупки нового абонемента или продления текущего

### Пропуск тренировок
- Отмена школой: автоматическое продление срока
- Пропуск клиентом с предупреждением: возможность переноса
- Пропуск без предупреждения: тренировка списывается

## Правила и ограничения

### Основные правила
- Стандартный срок - 1 календарный месяц
- Фиксированное количество тренировок (4 или 8)
- Максимум 3 переносимые тренировки
- Перенос только при автопродлении

### Продление срока
- Только при отмене школой
- Автоматический пересчет даты окончания
- Сохранение истории продлений

### Автопродление
- Создание инвойса за 3 дня
- Активация сразу после окончания предыдущего абонемента, независимо от статуса оплаты
- Возможность переноса пропущенных тренировок

## Технические аспекты
- Автоматический учет посещений
- Контроль количества оставшихся тренировок
- Система уведомлений о:
  * Скором окончании абонемента
  * Создании инвойса на продление
  * Успешном продлении
  * Переносе тренировок
- Логирование всех изменений 